
<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart School Portal | Amit Murolia</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@700;800&family=Hind:wght@400;500;600;700&display=swap');
        :root { --primary: #1e3a8a; --sidebar-bg: #1e3a8a; --accent: #b91c1c; --gold: #facc15; }
        body { font-family: 'Hind', sans-serif; background: #e2e8f0; margin: 0; user-select: none; }

        .scrolling-banner { background: #000; color: var(--gold); padding: 10px 0; font-weight: bold; width: 100%; border-bottom: 3px solid var(--accent); position: fixed; top: 0; text-align:center; z-index: 10001; text-transform: uppercase; }

        /* --- Login Screen --- */
        #login-screen { position: fixed; inset: 0; background: radial-gradient(circle at center, #1e3a8a 0%, #0a192f 100%); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 10000; }
        .slogan-box { color: white; text-align: center; margin-bottom: 20px; margin-top: 60px; }
        .login-card { display: flex; width: 1100px; background: white; border-radius: 20px; overflow: hidden; box-shadow: 0 25px 50px rgba(0,0,0,0.5); }
        
        .instruction-side { flex: 1.6; padding: 35px; background: #f0f7ff; border-right: 1px solid #dbeafe; overflow-y: auto; max-height: 80vh; }
        .instruction-side h2 { color: var(--primary); margin-top: 0; border-bottom: 3px solid var(--gold); display: inline-block; padding-bottom: 5px; }
        
        .step-box { background: white; padding: 15px; border-radius: 10px; margin-bottom: 12px; border-left: 6px solid var(--primary); box-shadow: 0 4px 6px rgba(0,0,0,0.05); }
        .step-box b { color: var(--accent); display: block; margin-bottom: 5px; font-size: 16px; border-bottom: 1px dashed #ddd; padding-bottom: 3px; }
        .step-box p { margin: 0; font-size: 14px; line-height: 1.5; color: #333; }

        /* --- Sidebar UI --- */
        #dashboard { display: none; }
        .main-layout { display: grid; grid-template-columns: 380px 1fr; min-height: 100vh; }
        .sidebar { background: var(--sidebar-bg); color: white; padding: 25px; height: 100vh; overflow-y: auto; position: sticky; top: 0; border-right: 5px solid var(--gold); box-sizing: border-box; }
        .sidebar h3 { color: var(--gold); text-align: center; border-bottom: 1px solid rgba(255,255,255,0.2); padding-bottom: 10px; margin-top: 40px; }
        
        label { display: block; font-size: 11px; font-weight: bold; color: #cbd5e1; margin-top: 15px; text-transform: uppercase; }
        input, textarea, select { width: 100%; padding: 10px; margin-top: 5px; border: none; border-radius: 8px; background: #fff; color: #000; font-weight: 600; box-sizing: border-box; }
        .btn { width: 100%; padding: 12px; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; margin-top: 10px; }
        .btn-gen { background: var(--gold); color: black; }

        /* --- Card Unit Layout --- */
        .page { background: #f1f5f9; width: 210mm; min-height: 296mm; margin: 0 auto; padding: 8mm 0; display: flex; flex-direction: column; align-items: center; box-sizing: border-box; }
        .card-unit { page-break-inside: avoid; display: flex; flex-direction: column; align-items: center; width: 100%; margin-bottom: 5mm; }
        .card-frame { border: 8px double var(--primary); padding: 10px; position: relative; background: #fff; display: flex; flex-direction: column; justify-content: space-between; box-sizing: border-box; overflow: hidden; width: 190mm; }
        
        .size-2 { height: 135mm; }
        .size-3 { height: 90mm; }
        .size-4 { height: 66mm; border-width: 5px; padding: 6px; }

        .card-header { display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid #000; padding-bottom: 4px; height: 60px; }
        .logo-box { height: 55px; width: 60px; object-fit: contain; }
        .logo-box[src=""], .logo-box:not([src]) { display: none; }
        .school-info { text-align: center; flex: 1; }
        .school-info h2 { margin: 0; color: var(--accent); font-weight: 800; font-size: 20px; line-height: 1; }
        
        .card-body { flex: 1; text-align: center; display: flex; flex-direction: column; justify-content: center; z-index: 1; }
        .msg-text { font-size: 15px; line-height: 1.35; margin: 5px 15px; text-align: justify; color: #222; }
        .size-4 .msg-text { font-size: 12px; line-height: 1.2; margin: 2px 10px; }

        .info-strip { background: #f1f5f9; padding: 6px; border: 2.5px solid var(--primary); display: flex; justify-content: space-around; font-weight: bold; font-size: 14px; color: #000; margin: 5px 0; }
        .size-4 .info-strip { font-size: 11px; padding: 3px; }
        
        .footer-line { background: #000; color: #fff; padding: 5px 12px; display: flex; justify-content: space-between; border-radius: 4px; font-size: 11px; margin-top: auto; }

        @media print { .no-print, #login-screen, .card-actions { display: none !important; } .page { background: white; padding: 0; } }
    </style>
</head>
<body>

<div id="login-screen">
    <div class="scrolling-banner">
        <marquee scrollamount="11">üöÄ DEVELOPED BY: AMIT MUROLIA (BCI) | GOVT SR SEC SCHOOL NARI, CHIRAWA ‚ú®</marquee>
    </div>
    <div class="slogan-box">
        <h1 style="color:var(--gold)">"‡§â‡§†‡•ã, ‡§ú‡§æ‡§ó‡•ã ‡§î‡§∞ ‡§§‡§¨ ‡§§‡§ï ‡§Æ‡§§ ‡§∞‡•Å‡§ï‡•ã ‡§ú‡§¨ ‡§§‡§ï ‡§≤‡§ï‡•ç‡§∑‡•ç‡§Ø ‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§ ‡§® ‡§π‡•ã ‡§ú‡§æ‡§è"</h1>
        <p style="color:white; font-size:20px;">‚Äî ‡§∏‡•ç‡§µ‡§æ‡§Æ‡•Ä ‡§µ‡§ø‡§µ‡•á‡§ï‡§æ‡§®‡§Ç‡§¶</p>
    </div>
    <div class="login-card">
        <div class="instruction-side">
            <h2>üìñ ‡§™‡•ã‡§∞‡•ç‡§ü‡§≤ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡•á ‡§®‡§ø‡§∞‡•ç‡§¶‡•á‡§∂ (Features Guide)</h2>
            
            <div class="step-box">
                <b>üìä ‡§¨‡§≤‡•ç‡§ï ‡§è‡§ï‡•ç‡§∏‡•á‡§≤ ‡§Æ‡•ã‡§° (Bulk Mode)</b>
                <p>Excel ‡§∂‡•Ä‡§ü ‡§∏‡•á ‡§ï‡•ç‡§≤‡§æ‡§∏, ‡§®‡§æ‡§Æ, ‡§™‡§ø‡§§‡§æ ‡§î‡§∞ ‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ ‡§®‡§Ç‡§¨‡§∞ ‡§ï‡•á ‡§ï‡•â‡§≤‡§Æ ‡§ï‡•â‡§™‡•Ä ‡§ï‡§∞‡§ï‡•á ‡§è‡§ï ‡§∏‡§æ‡§• ‡§™‡•á‡§∏‡•ç‡§ü ‡§ï‡§∞‡•á‡§Ç‡•§ ‡§Ø‡§π ‡§∏‡•à‡§ï‡•ú‡•ã‡§Ç ‡§ï‡§æ‡§∞‡•ç‡§° ‡§Æ‡§ø‡§®‡§ü‡•ã‡§Ç ‡§Æ‡•á‡§Ç ‡§¨‡§®‡§æ‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§∏‡§¨‡§∏‡•á ‡§¨‡•á‡§∏‡•ç‡§ü ‡§π‡•à‡•§</p>
            </div>
            
            <div class="step-box">
                <b>‚úèÔ∏è ‡§Æ‡•à‡§®‡•ç‡§Ø‡•Å‡§Ö‡§≤ ‡§õ‡§æ‡§§‡•ç‡§∞ ‡§Æ‡•ã‡§° (Manual Mode)</b>
                <p>‡§Ø‡§¶‡§ø ‡§Ü‡§™‡§ï‡•ã ‡§ï‡§ø‡§∏‡•Ä ‡§è‡§ï ‡§õ‡§æ‡§§‡•ç‡§∞ ‡§ï‡§æ ‡§ï‡§æ‡§∞‡•ç‡§° ‡§Ö‡§≤‡§ó ‡§∏‡•á ‡§¨‡§®‡§æ‡§®‡§æ ‡§π‡•à, ‡§§‡•ã ‡§á‡§∏ ‡§Æ‡•ã‡§° ‡§Æ‡•á‡§Ç ‡§â‡§∏‡§ï‡•Ä ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä ‡§≠‡§∞‡§ï‡§∞ ‡§§‡•Å‡§∞‡§Ç‡§§ ‡§ï‡§æ‡§∞‡•ç‡§° ‡§ú‡§®‡§∞‡•á‡§ü ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç‡•§</p>
            </div>

            <div class="step-box">
                <b>üë§ ‡§Ö‡§§‡§ø‡§•‡§ø ‡§Æ‡•ã‡§° (Guest Mode)</b>
                <p>‡§µ‡§ø‡§∂‡•á‡§∑ ‡§Ö‡§§‡§ø‡§•‡§ø‡§Ø‡•ã‡§Ç ‡§Ø‡§æ ‡§Ö‡§≠‡§ø‡§≠‡§æ‡§µ‡§ï‡•ã‡§Ç ‡§ï‡•á ‡§≤‡§ø‡§è ‡§¨‡§ø‡§®‡§æ ‡§ï‡•ç‡§≤‡§æ‡§∏ ‡§î‡§∞ ‡§™‡§ø‡§§‡§æ ‡§ï‡•á ‡§®‡§æ‡§Æ ‡§µ‡§æ‡§≤‡§æ ‡§ï‡§∏‡•ç‡§ü‡§Æ‡§æ‡§á‡•õ‡•ç‡§° ‡§®‡§ø‡§Æ‡§Ç‡§§‡•ç‡§∞‡§£ ‡§™‡§§‡•ç‡§∞ ‡§§‡•à‡§Ø‡§æ‡§∞ ‡§ï‡§∞‡§®‡•á ‡§π‡•á‡§§‡•Å ‡§á‡§∏‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡•á‡§Ç‡•§</p>
            </div>

            <div class="step-box">
                <b>üì± ‡§∏‡•ç‡§Æ‡§æ‡§∞‡•ç‡§ü ‡§´‡•Ä‡§ö‡§∞‡•ç‡§∏ (WhatsApp & Photo)</b>
                <p>‡§§‡•à‡§Ø‡§æ‡§∞ ‡§ï‡§æ‡§∞‡•ç‡§° ‡§ï‡•ã 'WhatsApp Send' ‡§¨‡§ü‡§® ‡§∏‡•á ‡§∏‡•Ä‡§ß‡•á ‡§Ö‡§≠‡§ø‡§≠‡§æ‡§µ‡§ï ‡§ï‡•ã ‡§≠‡•á‡§ú‡•á‡§Ç ‡§Ø‡§æ 'Save Image' ‡§¨‡§ü‡§® ‡§∏‡•á ‡§Ö‡§™‡§®‡•Ä ‡§ó‡•à‡§≤‡§∞‡•Ä ‡§Æ‡•á‡§Ç ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§ø‡§§ ‡§ï‡§∞‡•á‡§Ç‡•§</p>
            </div>

            <div class="step-box">
                <b>üñ®Ô∏è ‡§™‡•ç‡§∞‡§ø‡§Ç‡§ü‡§ø‡§Ç‡§ó ‡§∏‡•á‡§ü‡§ø‡§Ç‡§ó‡•ç‡§∏ (Best Print Settings)</b>
                <p>A4 ‡§™‡•á‡§ú ‡§™‡§∞ 2, 3 ‡§Ø‡§æ 4 ‡§ï‡§æ‡§∞‡•ç‡§° ‡§∏‡•á‡§ü ‡§ï‡§∞‡•á‡§Ç‡•§ ‡§™‡•ç‡§∞‡§ø‡§Ç‡§ü (Ctrl+P) ‡§ï‡§∞‡§§‡•á ‡§∏‡§Æ‡§Ø <b>'Background Graphics'</b> ‡§ï‡•ã ‡§π‡§Æ‡•á‡§∂‡§æ <b>ON</b> ‡§∞‡§ñ‡•á‡§Ç ‡§î‡§∞ <b>'Margins'</b> ‡§ï‡•ã <b>None</b> ‡§™‡§∞ ‡§∏‡•á‡§ü ‡§ï‡§∞‡•á‡§Ç‡•§</p>
            </div>
        </div>
        <div class="auth-side" style="flex:0.6; padding:40px; text-align:center; background:#fff; align-self:center;">
            <div style="font-size: 50px;">üèõÔ∏è</div>
            <h3 style="color:#000;">‡§è‡§°‡§Æ‡§ø‡§® ‡§≤‡•â‡§ó‡§ø‡§®</h3>
            <input type="password" id="passInp" placeholder="Enter Nari123">
            <button class="btn btn-gen" style="width:100%; margin-top:20px;" onclick="login()">Dashboard ‡§ñ‡•ã‡§≤‡•á‡§Ç</button>
        </div>
    </div>
</div>

<div id="dashboard">
    <div class="scrolling-banner no-print">
        <marquee scrollamount="11">üöÄ DEVELOPED BY: AMIT MUROLIA (BCI) | GOVT SR SEC SCHOOL NARI, CHIRAWA ‚ú®</marquee>
    </div>
    <div class="main-layout">
        <div class="sidebar no-print">
            <h3>‚öôÔ∏è ‡§∏‡•ç‡§Æ‡§æ‡§∞‡•ç‡§ü ‡§ï‡§Ç‡§ü‡•ç‡§∞‡•ã‡§≤</h3>
            
            <label>‡§ï‡§æ‡§∞‡•ç‡§Ø ‡§Æ‡•ã‡§° ‡§ö‡•Å‡§®‡•á‡§Ç</label>
            <select id="mode" onchange="toggleMode()">
                <option value="bulk">üìä ‡§è‡§ï‡•ç‡§∏‡•á‡§≤ ‡§¨‡§≤‡•ç‡§ï (Bulk)</option>
                <option value="manual">‚úèÔ∏è ‡§Æ‡•à‡§®‡•ç‡§Ø‡•Å‡§Ö‡§≤ (Manual)</option>
                <option value="guest">üë§ ‡§Ö‡§§‡§ø‡§•‡§ø (Guest)</option>
            </select>

            <div id="bulkSec">
                <label>Excel ‡§°‡•á‡§ü‡§æ ‡§Ø‡§π‡§æ‡§Å ‡§™‡•á‡§∏‡•ç‡§ü ‡§ï‡§∞‡•á‡§Ç</label>
                <textarea id="rawInput" rows="3" oninput="saveAllData(); updateFilters();" placeholder="Class [Tab] Name [Tab] Father [Tab] Mobile"></textarea>
                <select id="classFilter" onchange="render()"><option value="all">‡§∏‡§≠‡•Ä ‡§ï‡•ç‡§≤‡§æ‡§∏</option></select>
            </div>

            <div id="manualSec" style="display:none;">
                <input type="text" id="mC" placeholder="Class" oninput="saveAllData()"><input type="text" id="mN" placeholder="Name" oninput="saveAllData()"><input type="text" id="mF" placeholder="Father" oninput="saveAllData()"><input type="text" id="mM" placeholder="Mobile" oninput="saveAllData()">
            </div>

            <div id="guestSec" style="display:none;">
                <input type="text" id="gName" placeholder="Guest Name" oninput="saveAllData()"><input type="text" id="gMob" placeholder="Mobile" oninput="saveAllData()">
            </div>

            <label>‡§µ‡§ø‡§≠‡§æ‡§ó ‡§ï‡§æ ‡§®‡§æ‡§Æ</label><input type="text" id="dept" value="‡•• ‡§∞‡§æ‡§ú‡§∏‡•ç‡§•‡§æ‡§® ‡§∂‡§ø‡§ï‡•ç‡§∑‡§æ ‡§µ‡§ø‡§≠‡§æ‡§ó ‡••" oninput="saveAllData()">
            <label>‡§∏‡•ç‡§ï‡•Ç‡§≤ ‡§ï‡§æ ‡§®‡§æ‡§Æ</label><input type="text" id="sName" value="‡§∞‡§æ‡§ú‡§ï‡•Ä‡§Ø ‡§â‡§ö‡•ç‡§ö ‡§Æ‡§æ‡§ß‡•ç‡§Ø‡§Æ‡§ø‡§ï ‡§µ‡§ø‡§¶‡•ç‡§Ø‡§æ‡§≤‡§Ø, ‡§®‡§æ‡§∞‡•Ä" oninput="saveAllData()">
            <label>‡§ï‡§æ‡§∞‡•ç‡§° ‡§π‡•á‡§°‡§ø‡§Ç‡§ó</label><input type="text" id="hText" value="‡§®‡§ø‡§Æ‡§Ç‡§§‡•ç‡§∞‡§£: ‡§®‡§ø‡§™‡•Å‡§£ ‡§Æ‡•á‡§≤‡§æ ‡§è‡§µ‡§Ç ‡§Æ‡•á‡§ó‡§æ PTM" oninput="saveAllData()">
            <label>‡§∏‡§Ç‡§¶‡•á‡§∂</label><textarea id="mText" oninput="saveAllData()">‡§∏‡§æ‡§¶‡§∞ ‡§®‡§Æ‡§∏‡•ç‡§ï‡§æ‡§∞‡•§ ‡§µ‡§ø‡§¶‡•ç‡§Ø‡§æ‡§≤‡§Ø ‡§Æ‡•á‡§Ç ‡§Ö‡§ß‡•ç‡§Ø‡§Ø‡§®‡§∞‡§§ ‡§µ‡§ø‡§¶‡•ç‡§Ø‡§æ‡§∞‡•ç‡§•‡§ø‡§Ø‡•ã‡§Ç ‡§ï‡•á ‡§∂‡•à‡§ï‡•ç‡§∑‡§£‡§ø‡§ï ‡§ï‡•å‡§∂‡§≤ ‡§™‡•ç‡§∞‡§¶‡§∞‡•ç‡§∂‡§® ‡§π‡•á‡§§‡•Å "‡§®‡§ø‡§™‡•Å‡§£ ‡§Æ‡•á‡§≤‡§æ" ‡§è‡§µ‡§Ç "‡§Æ‡•á‡§ó‡§æ ‡§™‡•Ä.‡§ü‡•Ä.‡§è‡§Æ." ‡§ï‡§æ ‡§Ü‡§Ø‡•ã‡§ú‡§® ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ ‡§∞‡§π‡§æ ‡§π‡•à‡•§ ‡§¨‡§ö‡•ç‡§ö‡•ã‡§Ç ‡§ï‡•á ‡§∏‡§∞‡•ç‡§µ‡§æ‡§Ç‡§ó‡•Ä‡§£ ‡§µ‡§ø‡§ï‡§æ‡§∏ ‡§π‡•á‡§§‡•Å ‡§Ü‡§™‡§ï‡•Ä ‡§ó‡§∞‡§ø‡§Æ‡§æ‡§Æ‡§Ø‡•Ä ‡§â‡§™‡§∏‡•ç‡§•‡§ø‡§§‡§ø ‡§∏‡§æ‡§¶‡§∞ ‡§Ö‡§™‡•á‡§ï‡•ç‡§∑‡§ø‡§§ ‡§π‡•à‡•§</textarea>
            
            <label>‡§¶‡§ø‡§®‡§æ‡§Ç‡§ï / ‡§∏‡•ç‡§•‡§æ‡§® / ‡§µ‡§ø‡§®‡•Ä‡§§</label>
            <input type="text" id="dt" value="üìÖ 23 ‡§ú‡§®‡§µ‡§∞‡•Ä 2026 | ‚è∞ 11:00 AM" oninput="saveAllData()">
            <input type="text" id="vn" value="üìç ‡§µ‡§ø‡§¶‡•ç‡§Ø‡§æ‡§≤‡§Ø ‡§∏‡§≠‡§æ ‡§≠‡§µ‡§®" oninput="saveAllData()">
            <input type="text" id="vt" value="‡§™‡•ç‡§∞‡§ß‡§æ‡§®‡§æ‡§ö‡§æ‡§∞‡•ç‡§Ø ‡§è‡§µ‡§Ç ‡§∏‡§Æ‡§∏‡•ç‡§§ ‡§∏‡•ç‡§ü‡§æ‡§´" oninput="saveAllData()">

            <label>‡§™‡•ç‡§∞‡§ø‡§Ç‡§ü‡§ø‡§Ç‡§ó ‡§ó‡•ç‡§∞‡§ø‡§° (A4)</label>
            <select id="gridMode" onchange="render()"><option value="2">2 ‡§ï‡§æ‡§∞‡•ç‡§°</option><option value="3">3 ‡§ï‡§æ‡§∞‡•ç‡§°</option><option value="4">4 ‡§ï‡§æ‡§∞‡•ç‡§°</option></select>

            <label>‡§≤‡•ã‡§ó‡•ã / ‡§µ‡§æ‡§ü‡§∞‡§Æ‡§æ‡§∞‡•ç‡§ï</label>
            <div style="display:flex; gap:5px;"><input type="file" id="lImg" title="Left"><input type="file" id="rImg" title="Right"></div>
            <input type="file" id="bgImg">

            <button class="btn btn-gen" onclick="render()">‚úÖ ‡§ï‡§æ‡§∞‡•ç‡§° ‡§§‡•à‡§Ø‡§æ‡§∞ ‡§ï‡§∞‡•á‡§Ç</button>
            <button class="btn" style="background:#3b82f6; color:white;" onclick="window.print()">üñ®Ô∏è Direct Print</button>
            <button class="btn" style="background:#000; color:white;" onclick="saveAsPDF()">üìÑ Save as PDF</button>
            <button class="btn" style="background:#475569; color:white; margin-top:20px;" onclick="localStorage.clear(); location.reload();">üóëÔ∏è Clear Data</button>
        </div>
        <div class="preview-pane" id="outArea"></div>
    </div>
</div>

<script>
    let leftLogo = "", rightLogo = "", watermark = "";
    function login() { if(document.getElementById('passInp').value === "Nari123") { document.getElementById('login-screen').style.display='none'; document.getElementById('dashboard').style.display='block'; } else alert("‡§ó‡§≤‡§§ ‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§°!"); }
    
    function toggleMode() { 
        let m = document.getElementById('mode').value;
        document.getElementById('bulkSec').style.display = (m==='bulk'?'block':'none');
        document.getElementById('manualSec').style.display = (m==='manual'?'block':'none');
        document.getElementById('guestSec').style.display = (m==='guest'?'block':'none');
    }

    function saveAllData() {
        const d = { raw: document.getElementById('rawInput').value, sName: document.getElementById('sName').value, hText: document.getElementById('hText').value, mText: document.getElementById('mText').value, dept: document.getElementById('dept').value, dt: document.getElementById('dt').value, vn: document.getElementById('vn').value, vt: document.getElementById('vt').value, mC: document.getElementById('mC').value, mN: document.getElementById('mN').value, mF: document.getElementById('mF').value, mM: document.getElementById('mM').value, gN: document.getElementById('gName').value, gM: document.getElementById('gMob').value };
        localStorage.setItem('amitFinalStore2026', JSON.stringify(d));
    }

    function loadAllData() {
        const d = JSON.parse(localStorage.getItem('amitFinalStore2026'));
        if(d) {
            document.getElementById('rawInput').value = d.raw || "";
            document.getElementById('sName').value = d.sName || "‡§∞‡§æ‡§ú‡§ï‡•Ä‡§Ø ‡§â‡§ö‡•ç‡§ö ‡§Æ‡§æ‡§ß‡•ç‡§Ø‡§Æ‡§ø‡§ï ‡§µ‡§ø‡§¶‡•ç‡§Ø‡§æ‡§≤‡§Ø, ‡§®‡§æ‡§∞‡•Ä";
            document.getElementById('hText').value = d.hText || "";
            document.getElementById('mText').value = d.mText || "";
            document.getElementById('dept').value = d.dept || "‡•• ‡§∞‡§æ‡§ú‡§∏‡•ç‡§•‡§æ‡§® ‡§∂‡§ø‡§ï‡•ç‡§∑‡§æ ‡§µ‡§ø‡§≠‡§æ‡§ó ‡••";
            document.getElementById('dt').value = d.dt || "";
            document.getElementById('vn').value = d.vn || "";
            document.getElementById('vt').value = d.vt || "";
            document.getElementById('mC').value = d.mC || ""; document.getElementById('mN').value = d.mN || ""; document.getElementById('mF').value = d.mF || ""; document.getElementById('mM').value = d.mM || "";
            document.getElementById('gName').value = d.gN || ""; document.getElementById('gMob').value = d.gM || "";
            updateFilters();
        }
    }
    window.onload = loadAllData;

    document.getElementById('lImg').onchange = (e) => { const r = new FileReader(); r.onload=()=>leftLogo=r.result; r.readAsDataURL(e.target.files[0]); };
    document.getElementById('rImg').onchange = (e) => { const r = new FileReader(); r.onload=()=>rightLogo=r.result; r.readAsDataURL(e.target.files[0]); };
    document.getElementById('bgImg').onchange = (e) => { const r = new FileReader(); r.onload=()=>watermark=r.result; r.readAsDataURL(e.target.files[0]); };
    function updateFilters() { const input = document.getElementById('rawInput').value.trim(); const filter = document.getElementById('classFilter'); const classes = new Set(); input.split('\n').forEach(line => { const d = line.split(/\t/); if(d[0]) classes.add(d[0].trim()); }); filter.innerHTML = '<option value="all">‡§∏‡§≠‡•Ä ‡§ï‡•ç‡§≤‡§æ‡§∏</option>'; Array.from(classes).sort().forEach(c => { const opt = document.createElement('option'); opt.value = c; opt.innerText = "Class: " + c; filter.appendChild(opt); }); }

    function render() {
        const area = document.getElementById('outArea'); area.innerHTML = '';
        const grid = document.getElementById('gridMode').value, sName = document.getElementById('sName').value;
        const mode = document.getElementById('mode').value, hText = document.getElementById('hText').value, mText = document.getElementById('mText').value;
        const dept = document.getElementById('dept').value, filter = document.getElementById('classFilter').value;
        
        let list = [];
        if(mode==='bulk') {
            document.getElementById('rawInput').value.trim().split('\n').forEach((line) => {
                let d = line.split(/\t/); if(d[1] && (filter === 'all' || d[0].trim() === filter)) list.push({ c1: d[0], c2: d[1], c3: d[2], mob: d[3]||"", type: 'stu' });
            });
        } else if(mode==='manual') {
            list.push({ c1: document.getElementById('mC').value, c2: document.getElementById('mN').value, c3: document.getElementById('mF').value, mob: document.getElementById('mM').value, type: 'stu' });
        } else {
            list.push({ c1: 'Guest', c2: document.getElementById('gName').value, mob: document.getElementById('gMob').value, type: 'guest' });
        }

        const build = (d) => `
            <div class="card-unit">
                <div class="card-frame size-${grid}">
                    ${watermark ? `<img src="${watermark}" style="position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); width:35%; opacity:0.12;">` : ''}
                    <div class="card-header">
                        <img src="${leftLogo || ''}" class="logo-box">
                        <div class="school-info"><small>${dept}</small><h2>${sName}</h2></div>
                        <img src="${rightLogo || ''}" class="logo-box">
                    </div>
                    <div class="card-body">
                        <h3 style="text-decoration:underline; font-size:18px; color:#000; margin-bottom:2px;">${hText}</h3>
                        <p class="msg-text">${mText}</p>
                        <div class="info-strip">${d.type==='stu' ? `<span>Class :- ${d.c1}</span> <span>Name :- ${d.c2}</span> <span>Father's Name :- Mr. ${d.c3}</span>` : `<span>Guest :- ${d.c2}</span>`}</div>
                    </div>
                    <div class="footer-line"><span>${document.getElementById('dt').value}</span><span>${document.getElementById('vn').value}</span><span>‡§µ‡§ø‡§®‡•Ä‡§§: ${document.getElementById('vt').value}</span></div>
                </div>
                <div class="card-actions no-print" style="display:flex; gap:10px; margin-top:5px; margin-bottom:15px;">
                    <button class="btn" style="background:#25D366; color:white; padding:5px 15px; margin:0;" onclick="window.open('https://wa.me/91${d.mob}')">WhatsApp Send</button>
                    <button class="btn" style="background:#444; color:white; padding:5px 15px; margin:0;" onclick="saveImg(this)">Save Image</button>
                </div>
            </div>`;

        const perPage = parseInt(grid);
        for (let i = 0; i < list.length; i += perPage) {
            let p = document.createElement('div'); p.className = 'page';
            for(let j = 0; j < perPage; j++) { if(list[i+j]) p.innerHTML += build(list[i+j]); }
            area.appendChild(p);
        }
    }
    function saveImg(btn) { html2canvas(btn.parentElement.previousElementSibling, { scale: 3 }).then(canvas => { const link = document.createElement('a'); link.download = 'Invitation.png'; link.href = canvas.toDataURL(); link.click(); }); }
    async function saveAsPDF() {
        const pages = document.querySelectorAll('.page'); const { jsPDF } = window.jspdf; const pdf = new jsPDF('p', 'mm', 'a4');
        for (let i = 0; i < pages.length; i++) {
            const canvas = await html2canvas(pages[i], { scale: 2, onclone: (cl) => cl.querySelectorAll('.card-actions').forEach(a => a.style.display='none') });
            if (i > 0) pdf.addPage(); pdf.addImage(canvas.toDataURL('image/jpeg', 0.8), 'JPEG', 0, 0, 210, 297);
        }
        pdf.save('Invitations.pdf');
    }
</script>
</body>
</html>
